"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.RequestQueue = void 0;
/**
 * A queue that can be used to queue up requests.
 */
class RequestQueue {
    constructor() {
        Object.defineProperty(this, "_items", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: void 0
        });
        Object.defineProperty(this, "_pendingPromise", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: void 0
        });
        this._items = [];
        this._pendingPromise = false;
    }
    /**
     * Enqueues an action to be executed.
     * @param action - The action to execute.
     */
    enqueue(action) {
        return new Promise((resolve, reject) => {
            this._items.push({ action, resolve, reject });
            this.dequeue();
        });
    }
    /**
     * Dequeues the first action to be executed.
     */
    async dequeue() {
        if (this._pendingPromise)
            return false;
        const item = this._items.shift();
        if (!item)
            return false;
        try {
            this._pendingPromise = true;
            const payload = await item.action(this);
            this._pendingPromise = false;
            item.resolve(payload);
        }
        catch (e) {
            this._pendingPromise = false;
            item.reject(e);
        }
        finally {
            this.dequeue();
        }
        return true;
    }
}
exports.RequestQueue = RequestQueue;
//# sourceMappingURL=requestQueue.js.map